<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>PMERIT Classroom</title>
	<link rel="stylesheet" href="/assets/css/base.css">
	<link rel="stylesheet" href="/assets/css/brand.css">
	<link rel="stylesheet" href="/assets/css/components.css">
	<style>
		* { box-sizing: border-box; margin: 0; padding: 0; }
		body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #0b0c10; color: #e8eef8; line-height: 1.6; overflow-x: hidden; }
		.app-container { display: grid; grid-template-columns: 280px 1fr 320px; height: 100vh; gap: 1px; background-color: #1f2833; }
		.panel { background-color: #0b0c10; padding: 15px; overflow-y: auto; }
		.panel-title { font-weight: bold; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid #45a29e; color: #66fcf1; }
		.outline-item { padding: 10px; border-left: 3px solid transparent; cursor: pointer; transition: all 0.2s; }
		.outline-item:hover { background-color: #1f2833; border-left-color: #45a29e; }
		.outline-item.active { background-color: #1f2833; border-left-color: #66fcf1; font-weight: bold; }
		textarea { width: 100%; min-height: 120px; background-color: #1f2833; color: #e8eef8; border: 1px solid #45a29e; border-radius: 4px; padding: 10px; margin-bottom: 10px; resize: vertical; }
		button { background-color: #45a29e; color: #0b0c10; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; transition: background-color 0.2s; }
		button:hover { background-color: #66fcf1; }
		.topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #45a29e; }
		.player-area { background-color: #1f2833; border-radius: 8px; padding: 15px; margin-bottom: 15px; min-height: 300px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
		.avatar-placeholder { width: 200px; height: 200px; background: linear-gradient(135deg, #45a29e 0%, #1f2833 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; }
		.messages-container { height: 70vh; overflow-y: auto; margin-bottom: 15px; padding: 10px; background-color: #1f2833; border-radius: 8px; }
		.message { padding: 10px; border-radius: 8px; margin-bottom: 10px; max-width: 90%; }
		.message.user { background-color: #1d3557; margin-left: auto; }
		.message.ai { background-color: #2d3142; }
		.chat-form { display: flex; gap: 10px; }
		.chat-form input { flex-grow: 1; padding: 10px; background-color: #1f2833; color: #e8eef8; border: 1px solid #45a29e; border-radius: 4px; }
		@media (max-width: 1024px) { .app-container { grid-template-columns: 220px 1fr 280px; } }
		@media (max-width: 768px) { .app-container { grid-template-columns: 1fr; grid-template-rows: auto 1fr auto; } .panel { max-height: 300px; } }
	</style>
</head>
<body>
	<div class="app-container">
		<aside class="panel left-panel">
			<div class="panel-title">Class Outline</div>
			<div id="outline-container"></div>
			<div class="panel-title">Notes</div>
			<textarea id="notes-text" placeholder="Write your notes here..."></textarea>
			<button id="save-notes">Save Notes</button>
			<div class="panel-title">Resources</div>
			<div id="resources-container"></div>
			<input type="file" id="file-upload" multiple style="margin-top: 10px;">
		</aside>
		<main class="panel center-panel">
			<div class="topbar">
				<h1 id="lesson-title">Introduction to PMERIT Classroom</h1>
				<button id="end-class-btn">End Class</button>
			</div>
			<div class="player-area">
				<div class="avatar-placeholder"><span>Virtual Human</span></div>
				<div id="video-container"></div>
				<div id="quiz-container" style="display: none;"></div>
			</div>
			<div class="controls">
				<button id="prev-btn">Previous</button>
				<button id="next-btn">Next</button>
				<button id="replay-btn">Replay</button>
				<button id="raise-hand-btn">Raise Hand</button>
			</div>
		</main>
		<aside class="panel right-panel">
			<div class="panel-title">AI Tutor</div>
			<div class="messages-container" id="chat-messages"></div>
			<form class="chat-form" id="chat-form">
				<input type="text" id="chat-input" placeholder="Ask AI tutor...">
				<button type="submit">Send</button>
			</form>
		</aside>
	</div>
	<script>
		const PMERIT = (function() {
			const config = {
				API_BASE: "https://api.pmerit.com",
				LESSON_ID: "demo-lesson",
				USER_ID: localStorage.getItem("pmerit_user_id") || "guest",
				USER_TOKEN: localStorage.getItem("pmerit_token") || null
			};
			let state = { currentModule: 0, currentLesson: 0, notes: {}, chatHistory: [], resources: [] };
			const dom = {
				outlineContainer: document.getElementById('outline-container'),
				notesText: document.getElementById('notes-text'),
				saveNotesBtn: document.getElementById('save-notes'),
				resourcesContainer: document.getElementById('resources-container'),
				fileUpload: document.getElementById('file-upload'),
				lessonTitle: document.getElementById('lesson-title'),
				endClassBtn: document.getElementById('end-class-btn'),
				chatMessages: document.getElementById('chat-messages'),
				chatForm: document.getElementById('chat-form'),
				chatInput: document.getElementById('chat-input')
			};
			function init() {
				bindEvents();
				loadLessonData();
				loadUserNotes();
				initializeChat();
				renderOutline();
				console.log("PMERIT Classroom initialized successfully");
			}
			function bindEvents() {
				dom.saveNotesBtn.addEventListener('click', saveNotes);
				dom.fileUpload.addEventListener('change', handleFileUpload);
				dom.endClassBtn.addEventListener('click', endClass);
				dom.chatForm.addEventListener('submit', handleChatSubmit);
			}
			function loadLessonData() {
				const demoData = {
					title: "Introduction to PMERIT Classroom",
					modules: [
						{ title: "Module 1: Getting Started", lessons: [ { title: "Welcome to PMERIT", type: "video", duration: "2:30" }, { title: "How to Use This Platform", type: "video", duration: "5:15" } ] },
						{ title: "Module 2: Core Concepts", lessons: [ { title: "Basic Principles", type: "video", duration: "7:20" }, { title: "Advanced Techniques", type: "reading", duration: "10:00" } ] }
					]
				};
				dom.lessonTitle.textContent = demoData.title;
				state.courseData = demoData;
			}
			function loadUserNotes() {
				const savedNotes = localStorage.getItem(`pmerit_notes_${config.LESSON_ID}`);
				if (savedNotes) {
					state.notes = JSON.parse(savedNotes);
					dom.notesText.value = state.notes.content || "";
				}
			}
			function initializeChat() {
				addChatMessage("ai", "Hello! I'm your AI tutor. How can I help you today?");
			}
			function renderOutline() {
				if (!state.courseData || !state.courseData.modules) return;
				let outlineHTML = '';
				state.courseData.modules.forEach((module, moduleIndex) => {
					outlineHTML += `<div class="outline-item module">${module.title}</div>`;
					module.lessons.forEach((lesson, lessonIndex) => {
						outlineHTML += `<div class="outline-item lesson" data-module="${moduleIndex}" data-lesson="${lessonIndex}">
							${lesson.title} <small>(${lesson.type}, ${lesson.duration})</small>
						</div>`;
					});
				});
				dom.outlineContainer.innerHTML = outlineHTML;
				const lessonItems = dom.outlineContainer.querySelectorAll('.lesson');
				lessonItems.forEach(item => {
					item.addEventListener('click', function() {
						const moduleIndex = parseInt(this.dataset.module);
						const lessonIndex = parseInt(this.dataset.lesson);
						loadLesson(moduleIndex, lessonIndex);
					});
				});
			}
			function loadLesson(moduleIndex, lessonIndex) {
				console.log(`Loading lesson: Module ${moduleIndex}, Lesson ${lessonIndex}`);
				const allItems = dom.outlineContainer.querySelectorAll('.outline-item');
				allItems.forEach(item => item.classList.remove('active'));
				const activeItem = dom.outlineContainer.querySelector(`[data-module="${moduleIndex}"][data-lesson="${lessonIndex}"]`);
				if (activeItem) { activeItem.classList.add('active'); }
			}
			function saveNotes() {
				state.notes.content = dom.notesText.value;
				state.notes.lastSaved = new Date().toISOString();
				localStorage.setItem(`pmerit_notes_${config.LESSON_ID}`, JSON.stringify(state.notes));
				const confirmEl = document.createElement('div');
				confirmEl.textContent = 'Notes saved!';
				confirmEl.style = 'position: fixed; bottom: 20px; left: 20px; background: #45a29e; padding: 10px; border-radius: 4px;';
				document.body.appendChild(confirmEl);
				setTimeout(() => { document.body.removeChild(confirmEl); }, 2000);
			}
			function handleFileUpload(event) {
				const files = event.target.files;
				if (!files || files.length === 0) return;
				Array.from(files).forEach(file => {
					const resource = { name: file.name, type: file.type, size: file.size, uploadDate: new Date().toISOString() };
					state.resources.push(resource);
					renderResources();
				});
				dom.fileUpload.value = '';
			}
			function renderResources() {
				let resourcesHTML = '';
				state.resources.forEach(resource => {
					resourcesHTML += `<div class="resource-item"><strong>${resource.name}</strong> <small>(${formatFileSize(resource.size)})</small></div>`;
				});
				dom.resourcesContainer.innerHTML = resourcesHTML || '<p>No resources uploaded yet.</p>';
			}
			function formatFileSize(bytes) {
				if (bytes < 1024) return bytes + ' bytes';
				else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
				else return (bytes / 1048576).toFixed(1) + ' MB';
			}
			function handleChatSubmit(event) {
				event.preventDefault();
				const message = dom.chatInput.value.trim();
				if (!message) return;
				addChatMessage('user', message);
				dom.chatInput.value = '';
				setTimeout(() => {
					const responses = [
						"That's a great question! Based on what we've covered, the key concept is...",
						"I'd be happy to explain that. The main idea here is...",
						"Thanks for asking! This is an important point that relates to...",
						"Let me help with that. The concept you're referring to connects to..."
					];
					const randomResponse = responses[Math.floor(Math.random() * responses.length)];
					addChatMessage('ai', randomResponse);
				}, 1000 + Math.random() * 2000);
			}
			function addChatMessage(sender, text) {
				const messageEl = document.createElement('div');
				messageEl.classList.add('message', sender);
				messageEl.textContent = text;
				dom.chatMessages.appendChild(messageEl);
				dom.chatMessages.scrollTop = dom.chatMessages.scrollHeight;
				state.chatHistory.push({ sender, text, timestamp: new Date().toISOString() });
			}
			function endClass() {
				if (confirm("Are you sure you want to end the class? Your progress will be saved.")) {
					saveNotes();
					setTimeout(() => { alert("Class completed! Returning to dashboard..."); }, 500);
				}
			}
			return { init: init };
		})();
		document.addEventListener('DOMContentLoaded', PMERIT.init);
	</script>
</body>
</html>
