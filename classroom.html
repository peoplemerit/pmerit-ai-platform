<!DOCTYPE html>
<html lang="en" data-page="classroom" data-role="user">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom - PMERIT</title>
    <meta name="description" content="Interactive learning environment - access your courses, complete lessons, and track your progress in real-time.">
    <link rel="stylesheet" href="/assets/base.css">
    <style>
        /* Classroom-specific styles */
        .classroom-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 0;
            min-height: calc(100vh - 200px);
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            overflow: hidden;
        }
        
        .course-sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 0;
            overflow-y: auto;
        }
        
        .course-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background: var(--primary-color);
            color: white;
        }
        
        .course-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .course-progress {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        .course-nav {
            padding: 0;
        }
        
        .nav-section {
            border-bottom: 1px solid var(--border-color);
        }
        
        .section-header {
            padding: 15px 20px;
            background: var(--bg-tertiary);
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-toggle {
            font-size: 12px;
            transition: transform 0.2s;
        }
        
        .section-header.collapsed .section-toggle {
            transform: rotate(-90deg);
        }
        
        .section-content {
            display: block;
        }
        
        .section-content.collapsed {
            display: none;
        }
        
        .lesson-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .lesson-item:hover {
            background: var(--bg-tertiary);
        }
        
        .lesson-item.active {
            background: var(--primary-color);
            color: white;
        }
        
        .lesson-icon {
            font-size: 16px;
        }
        
        .lesson-content {
            flex: 1;
        }
        
        .lesson-title {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .lesson-duration {
            font-size: 11px;
            opacity: 0.7;
        }
        
        .lesson-status {
            font-size: 12px;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
        }
        
        .content-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-primary);
        }
        
        .content-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }
        
        .content-meta {
            display: flex;
            gap: 20px;
            align-items: center;
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .content-body {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .video-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto 30px;
            background: #000;
            border-radius: var(--radius-lg);
            overflow: hidden;
            position: relative;
        }
        
        .video-placeholder {
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .video-placeholder:hover {
            background: linear-gradient(135deg, #2a2a2a 0%, #444 100%);
        }
        
        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
        }
        
        .play-btn {
            background: var(--primary-color);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .video-progress {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .video-progress-fill {
            height: 100%;
            background: var(--primary-color);
            width: 35%;
            border-radius: 2px;
            transition: width 0.1s;
        }
        
        .video-time {
            font-size: 12px;
        }
        
        .lesson-content-text {
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .lesson-content-text h1, .lesson-content-text h2, .lesson-content-text h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
        }
        
        .lesson-content-text p {
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .lesson-content-text ul, .lesson-content-text ol {
            margin-bottom: 15px;
            padding-left: 20px;
        }
        
        .lesson-content-text li {
            margin-bottom: 5px;
            color: var(--text-primary);
        }
        
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: var(--radius);
            margin: 20px 0;
            overflow-x: auto;
            font-family: var(--font-mono);
            font-size: 14px;
        }
        
        .interactive-quiz {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin: 30px 0;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .quiz-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 15px;
        }
        
        .quiz-question {
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 20px;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quiz-option {
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.2s;
            background: var(--bg-primary);
        }
        
        .quiz-option:hover {
            border-color: var(--primary-color);
            background: var(--bg-secondary);
        }
        
        .quiz-option.selected {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }
        
        .quiz-feedback {
            padding: 15px;
            border-radius: var(--radius);
            margin-top: 15px;
            display: none;
        }
        
        .quiz-feedback.correct {
            background: #dcfce7;
            border: 1px solid #16a34a;
            color: #15803d;
        }
        
        .quiz-feedback.incorrect {
            background: #fef2f2;
            border: 1px solid #dc2626;
            color: #dc2626;
        }
        
        .content-navigation {
            padding: 20px 30px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .nav-btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .nav-btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .nav-btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .nav-btn-secondary:hover {
            background: var(--bg-primary);
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .lesson-completion {
            text-align: center;
            padding: 40px 20px;
        }
        
        .completion-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        .completion-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        
        .completion-description {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .classroom-container {
                grid-template-columns: 250px 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .classroom-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .course-sidebar {
                max-height: 300px;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            
            .content-body {
                padding: 20px;
            }
            
            .video-placeholder {
                height: 250px;
            }
        }
    </style>
</head>

<body>
    <!-- Shared header will be injected here -->
    <header id="header"></header>
    
    <!-- Shared navigation will be injected here -->
    <nav id="site-nav"></nav>
    
    <!-- Main classroom content -->
    <main class="container">
        <div class="classroom-container">
            
            <!-- Course Sidebar -->
            <aside class="course-sidebar">
                <div class="course-header">
                    <h2 class="course-title" id="courseTitle">Full-Stack Web Development</h2>
                    <div class="course-progress">
                        <span id="courseProgressText">Progress: 67% complete</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="courseProgressBar" style="width: 67%"></div>
                        </div>
                    </div>
                </div>
                
                <nav class="course-nav" id="courseNav">
                    <!-- Course navigation will be populated dynamically -->
                </nav>
            </aside>
            
            <!-- Main Content Area -->
            <div class="main-content">
                <header class="content-header">
                    <h1 class="content-title" id="contentTitle">Introduction to React Components</h1>
                    <div class="content-meta">
                        <div class="meta-item">
                            <span>📹</span>
                            <span id="contentDuration">12 minutes</span>
                        </div>
                        <div class="meta-item">
                            <span>📚</span>
                            <span id="contentType">Video Lesson</span>
                        </div>
                        <div class="meta-item">
                            <span>⭐</span>
                            <span id="contentDifficulty">Intermediate</span>
                        </div>
                    </div>
                </header>
                
                <div class="content-body" id="contentBody">
                    <!-- Video Content -->
                    <div class="video-container" id="videoContainer">
                        <div class="video-placeholder" id="videoPlaceholder">
                            ▶️
                        </div>
                        <div class="video-controls">
                            <button class="play-btn" id="playBtn">▶️</button>
                            <div class="video-progress">
                                <div class="video-progress-fill" id="videoProgressFill"></div>
                            </div>
                            <div class="video-time">
                                <span id="currentTime">4:20</span> / <span id="totalTime">12:00</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Lesson Content -->
                    <div class="lesson-content-text" id="lessonContent">
                        <h2>Learning Objectives</h2>
                        <ul>
                            <li>Understand the concept of React components</li>
                            <li>Learn the difference between functional and class components</li>
                            <li>Create your first React component</li>
                            <li>Pass data between components using props</li>
                        </ul>
                        
                        <h2>Introduction</h2>
                        <p>
                            React components are the building blocks of any React application. They allow you to split the UI into independent, 
                            reusable pieces that can be managed separately. In this lesson, we'll explore what components are and how to create them.
                        </p>
                        
                        <h2>What is a Component?</h2>
                        <p>
                            A component is a JavaScript function or class that returns JSX (JavaScript XML) to describe what should appear on the screen. 
                            Components can be as simple as a button or as complex as an entire page.
                        </p>
                        
                        <div class="code-block">
                            <pre><code>// Simple functional component
function Welcome(props) {
  return &lt;h1&gt;Hello, {props.name}!&lt;/h1&gt;;
}

// Using the component
&lt;Welcome name="PMERIT Learner" /&gt;</code></pre>
                        </div>
                        
                        <h2>Props: Passing Data</h2>
                        <p>
                            Props (short for "properties") are how you pass data from parent components to child components. 
                            They make components reusable and dynamic.
                        </p>
                    </div>
                    
                    <!-- Interactive Quiz -->
                    <div class="interactive-quiz" id="quiz1">
                        <h3 class="quiz-title">📝 Quick Check: React Components</h3>
                        <div class="quiz-question">
                            What is the primary purpose of React components?
                        </div>
                        <div class="quiz-options">
                            <div class="quiz-option" data-option="a">To style web pages with CSS</div>
                            <div class="quiz-option" data-option="b">To break UI into reusable, independent pieces</div>
                            <div class="quiz-option" data-option="c">To connect to databases</div>
                            <div class="quiz-option" data-option="d">To handle server-side logic</div>
                        </div>
                        <div class="quiz-feedback" id="quiz1Feedback"></div>
                    </div>
                </div>
                
                <!-- Content Navigation -->
                <div class="content-navigation">
                    <button class="nav-btn nav-btn-secondary" id="prevLessonBtn" data-i18n="previousLesson">Previous Lesson</button>
                    <div>
                        <button class="nav-btn nav-btn-secondary" id="markCompleteBtn" data-i18n="markComplete">Mark as Complete</button>
                    </div>
                    <button class="nav-btn nav-btn-primary" id="nextLessonBtn" data-i18n="nextLesson">Next Lesson</button>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Shared footer will be injected here -->
    <footer id="footer"></footer>
    
    <!-- Load shared functionality -->
    <script src="/assets/boot-includes.js" defer></script>
    <script src="/assets/nav-config.js" defer></script>
    
    <!-- Classroom-specific JavaScript -->
    <script>
        // Classroom application state and functionality
        const ClassroomApp = {
            courseId: null,
            currentLessonId: null,
            lessons: [],
            courseData: null,
            progress: {},
            
            // Initialize classroom
            init() {
                console.log('🏫 Classroom initialized');
                
                // Get course ID from URL params or default
                const urlParams = new URLSearchParams(window.location.search);
                this.courseId = urlParams.get('course') || '1'; // Default to course 1
                this.currentLessonId = urlParams.get('lesson') || '1'; // Default to lesson 1
                
                this.setupEventListeners();
                this.loadCourse();
            },
            
            setupEventListeners() {
                // Video controls
                const playBtn = PMERIT.utils.$('#playBtn');
                const videoPlaceholder = PMERIT.utils.$('#videoPlaceholder');
                
                if (playBtn) playBtn.addEventListener('click', () => this.toggleVideo());
                if (videoPlaceholder) videoPlaceholder.addEventListener('click', () => this.toggleVideo());
                
                // Navigation buttons
                const prevBtn = PMERIT.utils.$('#prevLessonBtn');
                const nextBtn = PMERIT.utils.$('#nextLessonBtn');
                const completeBtn = PMERIT.utils.$('#markCompleteBtn');
                
                if (prevBtn) prevBtn.addEventListener('click', () => this.previousLesson());
                if (nextBtn) nextBtn.addEventListener('click', () => this.nextLesson());
                if (completeBtn) completeBtn.addEventListener('click', () => this.markComplete());
                
                // Course navigation
                document.addEventListener('click', (e) => {
                    if (e.target.matches('.lesson-item, .lesson-item *')) {
                        const lessonItem = e.target.closest('.lesson-item');
                        if (lessonItem) {
                            this.selectLesson(lessonItem.getAttribute('data-lesson-id'));
                        }
                    }
                    
                    if (e.target.matches('.section-header')) {
                        this.toggleSection(e.target);
                    }
                    
                    if (e.target.matches('.quiz-option')) {
                        this.selectQuizOption(e.target);
                    }
                });
            },
            
            async loadCourse() {
                try {
                    // Load course data from your 78-table database
                    const response = await PMERIT.utils.fetchJson(`/api/courses/${this.courseId}/details`);
                    
                    if (response.success && response.course) {
                        this.courseData = response.course;
                        this.lessons = response.lessons || [];
                        this.progress = response.progress || {};
                    } else {
                        // Use fallback data for development
                        this.courseData = this.getFallbackCourseData();
                        this.lessons = this.getFallbackLessons();
                        this.progress = this.getFallbackProgress();
                    }
                    
                    this.renderCourseNavigation();
                    this.loadLesson(this.currentLessonId);
                    
                } catch (error) {
                    console.warn('Failed to load course data:', error);
                    this.courseData = this.getFallbackCourseData();
                    this.lessons = this.getFallbackLessons();
                    this.progress = this.getFallbackProgress();
                    
                    this.renderCourseNavigation();
                    this.loadLesson(this.currentLessonId);
                }
            },
            
            getFallbackCourseData() {
                return {
                    id: 1,
                    title: 'Full-Stack Web Development',
                    description: 'Learn to build complete web applications',
                    progress: 67,
                    totalLessons: 48,
                    completedLessons: 32
                };
            },
            
            getFallbackLessons() {
                return [
                    {
                        section: 'Getting Started',
                        lessons: [
                            { id: '1', title: 'Course Introduction', duration: '5 min', type: 'video', completed: true },
                            { id: '2', title: 'Development Environment Setup', duration: '15 min', type: 'video', completed: true },
                            { id: '3', title: 'HTML Fundamentals', duration: '20 min', type: 'video', completed: true }
                        ]
                    },
                    {
                        section: 'CSS & Styling',
                        lessons: [
                            { id: '4', title: 'CSS Basics', duration: '18 min', type: 'video', completed: true },
                            { id: '5', title: 'Flexbox Layout', duration: '22 min', type: 'video', completed: true },
                            { id: '6', title: 'CSS Grid System', duration: '25 min', type: 'video', completed: false }
                        ]
                    },
                    {
                        section: 'JavaScript Fundamentals',
                        lessons: [
                            { id: '7', title: 'Variables and Data Types', duration: '16 min', type: 'video', completed: false },
                            { id: '8', title: 'Functions and Scope', duration: '20 min', type: 'video', completed: false },
                            { id: '9', title: 'DOM Manipulation', duration: '24 min', type: 'video', completed: false }
                        ]
                    },
                    {
                        section: 'React Development',
                        lessons: [
                            { id: '10', title: 'Introduction to React', duration: '18 min', type: 'video', completed: false },
                            { id: '11', title: 'React Components', duration: '12 min', type: 'video', completed: false, current: true },
                            { id: '12', title: 'Props and State', duration: '20 min', type: 'video', completed: false }
                        ]
                    }
                ];
            },
            
            getFallbackProgress() {
                return {
                    overall: 67,
                    currentLesson: '11',
                    timeSpent: 240, // minutes
                    lastAccessed: new Date().toISOString()
                };
            },
            
            renderCourseNavigation() {
                const courseNav = PMERIT.utils.$('#courseNav');
                if (!courseNav) return;
                
                // Update course header
                PMERIT.utils.$('#courseTitle').textContent = this.courseData.title;
                PMERIT.utils.$('#courseProgressText').textContent = `Progress: ${this.courseData.progress}% complete`;
                PMERIT.utils.$('#courseProgressBar').style.width = `${this.courseData.progress}%`;
                
                // Render sections and lessons
                courseNav.innerHTML = this.lessons.map(section => {
                    const sectionLessons = section.lessons.map(lesson => {
                        const statusIcon = lesson.completed ? '✅' : lesson.current ? '▶️' : '⭕';
                        const activeClass = lesson.id === this.currentLessonId ? 'active' : '';
                        
                        return `
                            <div class="lesson-item ${activeClass}" data-lesson-id="${lesson.id}">
                                <span class="lesson-icon">${statusIcon}</span>
                                <div class="lesson-content">
                                    <div class="lesson-title">${lesson.title}</div>
                                    <div class="lesson-duration">${lesson.duration}</div>
                                </div>
                                <div class="lesson-status">${lesson.type === 'video' ? '🎥' : '📄'}</div>
                            </div>
                        `;
                    }).join('');
                    
                    return `
                        <div class="nav-section">
                            <div class="section-header">
                                <span>${section.section}</span>
                                <span class="section-toggle">▼</span>
                            </div>
                            <div class="section-content">
                                ${sectionLessons}
                            </div>
                        </div>
                    `;
                }).join('');
            },
            
            loadLesson(lessonId) {
                this.currentLessonId = lessonId;
                
                // Find lesson data
                const lesson = this.findLesson(lessonId);
                if (!lesson) return;
                
                // Update content header
                PMERIT.utils.$('#contentTitle').textContent = lesson.title;
                PMERIT.utils.$('#contentDuration').textContent = lesson.duration;
                PMERIT.utils.$('#contentType').textContent = lesson.type === 'video' ? 'Video Lesson' : 'Reading';
                PMERIT.utils.$('#contentDifficulty').textContent = lesson.difficulty || 'Intermediate';
                
                // Update navigation buttons
                const prevBtn = PMERIT.utils.$('#prevLessonBtn');
                const nextBtn = PMERIT.utils.$('#nextLessonBtn');
                const completeBtn = PMERIT.utils.$('#markCompleteBtn');
                
                const prevLesson = this.getPreviousLesson(lessonId);
                const nextLesson = this.getNextLesson(lessonId);
                
                prevBtn.disabled = !prevLesson;
                nextBtn.disabled = !nextLesson;
                completeBtn.textContent = lesson.completed ? 'Completed ✅' : 'Mark as Complete';
                completeBtn.disabled = lesson.completed;
                
                // Load lesson content (this would typically fetch from the database)
                this.loadLessonContent(lesson);
                
                // Update active lesson in sidebar
                PMERIT.utils.$$('.lesson-item.active').forEach(item => {
                    item.classList.remove('active');
                });
                const currentItem = PMERIT.utils.$(`[data-lesson-id="${lessonId}"]`);
                if (currentItem) currentItem.classList.add('active');
                
                // Update URL without reload
                const newUrl = new URL(window.location);
                newUrl.searchParams.set('lesson', lessonId);
                history.replaceState(null, '', newUrl);
            },
            
            loadLessonContent(lesson) {
                // This would typically load content from your database
                // For now, we'll use the existing content in the HTML
                
                if (lesson.type === 'video') {
                    PMERIT.utils.$('#videoContainer').style.display = 'block';
                } else {
                    PMERIT.utils.$('#videoContainer').style.display = 'none';
                }
                
                // Initialize quiz if present
                this.initializeQuiz();
            },
            
            initializeQuiz() {
                const quiz = PMERIT.utils.$('#quiz1');
                if (!quiz) return;
                
                // Reset quiz state
                PMERIT.utils.$$('.quiz-option.selected').forEach(option => {
                    option.classList.remove('selected');
                });
                PMERIT.utils.$('#quiz1Feedback').style.display = 'none';
            },
            
            selectQuizOption(optionEl) {
                const quiz = optionEl.closest('.interactive-quiz');
                
                // Remove previous selections
                quiz.querySelectorAll('.quiz-option.selected').forEach(option => {
                    option.classList.remove('selected');
                });
                
                // Select current option
                optionEl.classList.add('selected');
                
                // Check answer (B is correct)
                const selectedValue = optionEl.getAttribute('data-option');
                const feedback = quiz.querySelector('.quiz-feedback');
                
                if (selectedValue === 'b') {
                    feedback.className = 'quiz-feedback correct';
                    feedback.textContent = '✅ Correct! React components help break UI into reusable, independent pieces.';
                } else {
                    feedback.className = 'quiz-feedback incorrect';
                    feedback.textContent = '❌ Not quite. React components are primarily used to break UI into reusable, independent pieces.';
                }
                
                feedback.style.display = 'block';
            },
            
            findLesson(lessonId) {
                for (const section of this.lessons) {
                    const lesson = section.lessons.find(l => l.id === lessonId);
                    if (lesson) return lesson;
                }
                return null;
            },
            
            getPreviousLesson(lessonId) {
                let foundCurrent = false;
                let previousLesson = null;
                
                for (const section of this.lessons) {
                    for (const lesson of section.lessons) {
                        if (foundCurrent) return previousLesson;
                        if (lesson.id === lessonId) {
                            foundCurrent = true;
                            return previousLesson;
                        }
                        previousLesson = lesson;
                    }
                }
                return null;
            },
            
            getNextLesson(lessonId) {
                let foundCurrent = false;
                
                for (const section of this.lessons) {
                    for (const lesson of section.lessons) {
                        if (foundCurrent) return lesson;
                        if (lesson.id === lessonId) foundCurrent = true;
                    }
                }
                return null;
            },
            
            selectLesson(lessonId) {
                this.loadLesson(lessonId);
            },
            
            previousLesson() {
                const prevLesson = this.getPreviousLesson(this.currentLessonId);
                if (prevLesson) {
                    this.loadLesson(prevLesson.id);
                }
            },
            
            nextLesson() {
                const nextLesson = this.getNextLesson(this.currentLessonId);
                if (nextLesson) {
                    this.loadLesson(nextLesson.id);
                }
            },
            
            async markComplete() {
                try {
                    // Mark lesson as complete in database
                    await PMERIT.utils.fetchJson(`/api/courses/${this.courseId}/lessons/${this.currentLessonId}/complete`, {
                        method: 'POST'
                    });
                    
                    // Update local state
                    const lesson = this.findLesson(this.currentLessonId);
                    if (lesson) {
                        lesson.completed = true;
                    }
                    
                    // Update UI
                    this.renderCourseNavigation();
                    const completeBtn = PMERIT.utils.$('#markCompleteBtn');
                    completeBtn.textContent = 'Completed ✅';
                    completeBtn.disabled = true;
                    
                    // Auto-advance to next lesson
                    setTimeout(() => {
                        const nextLesson = this.getNextLesson(this.currentLessonId);
                        if (nextLesson) {
                            this.loadLesson(nextLesson.id);
                        }
                    }, 1000);
                    
                } catch (error) {
                    console.error('Failed to mark lesson complete:', error);
                }
            },
            
            toggleSection(sectionHeader) {
                const sectionContent = sectionHeader.nextElementSibling;
                const toggle = sectionHeader.querySelector('.section-toggle');
                
                if (sectionContent.classList.contains('collapsed')) {
                    sectionContent.classList.remove('collapsed');
                    sectionHeader.classList.remove('collapsed');
                    toggle.textContent = '▼';
                } else {
                    sectionContent.classList.add('collapsed');
                    sectionHeader.classList.add('collapsed');
                    toggle.textContent = '▶️';
                }
            },
            
            toggleVideo() {
                const playBtn = PMERIT.utils.$('#playBtn');
                const videoPlaceholder = PMERIT.utils.$('#videoPlaceholder');
                
                // This would integrate with actual video player
                if (playBtn.textContent === '▶️') {
                    playBtn.textContent = '⏸️';
                    videoPlaceholder.textContent = '⏸️';
                    this.simulateVideoProgress();
                } else {
                    playBtn.textContent = '▶️';
                    videoPlaceholder.textContent = '▶️';
                }
            },
            
            simulateVideoProgress() {
                // Simulate video progress for demo
                const progressFill = PMERIT.utils.$('#videoProgressFill');
                const currentTimeEl = PMERIT.utils.$('#currentTime');
                
                let currentProgress = 35;
                let currentSeconds = 260; // 4:20
                
                const interval = setInterval(() => {
                    if (PMERIT.utils.$('#playBtn').textContent === '▶️') {
                        clearInterval(interval);
                        return;
                    }
                    
                    currentProgress += 0.5;
                    currentSeconds += 1;
                    
                    progressFill.style.width = `${currentProgress}%`;
                    
                    const minutes = Math.floor(currentSeconds / 60);
                    const seconds = currentSeconds % 60;
                    currentTimeEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (currentProgress >= 100) {
                        clearInterval(interval);
                        this.markComplete();
                    }
                }, 1000);
            }
        };
        
        // Initialize classroom when app is ready
        PMERIT.events.on('app:ready', () => {
            ClassroomApp.init();
        });
    </script>
</body>
</html>
