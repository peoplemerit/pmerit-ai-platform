<!-- 
  PMERIT Auth Modal Component
  Version: 1.0
  Last Updated: October 25, 2025
  
  Reusable modal for Sign Up / Sign In flows
  Features: Tab switching, keyboard navigation, accessibility
  
  Usage: Include this partial and call AuthModal.open('signup') or AuthModal.open('signin')
-->

<div id="auth-modal" class="auth-modal" role="dialog" aria-modal="true" aria-labelledby="auth-modal-title" aria-hidden="true">
  <div class="auth-modal-backdrop">
    <div class="auth-modal-content">
      <!-- Close Button -->
      <button class="auth-modal-close" aria-label="Close modal">
        <i class="fas fa-times"></i>
      </button>
      
      <!-- Modal Header with Tabs -->
      <div class="auth-modal-header">
        <div class="auth-modal-tabs" role="tablist">
          <button 
            class="auth-modal-tab active" 
            id="signup-tab" 
            role="tab" 
            aria-selected="true" 
            aria-controls="signup-panel"
            data-tab="signup">
            Sign Up
          </button>
          <button 
            class="auth-modal-tab" 
            id="signin-tab" 
            role="tab" 
            aria-selected="false" 
            aria-controls="signin-panel"
            data-tab="signin">
            Sign In
          </button>
        </div>
      </div>
      
      <!-- Modal Body -->
      <div class="auth-modal-body">
        <!-- Sign Up Panel -->
        <div 
          id="signup-panel" 
          class="auth-modal-panel active" 
          role="tabpanel" 
          aria-labelledby="signup-tab"
          aria-hidden="false">
          
          <h2 id="auth-modal-title" class="auth-modal-title">Create Your Account</h2>
          <p class="auth-modal-subtitle">Create your PMERIT account to unlock your personalized learning journey.</p>

          <!-- Error/Success Messages -->
          <div id="signup-message" class="auth-modal-message" role="alert" aria-live="polite"></div>

          <form id="signup-form" class="auth-modal-form">
            <!-- Step 1: Account Type Selection -->
            <div id="signup-step-1" class="signup-step active">
              <div class="form-group account-type-group">
                <label class="form-label-main">Who is this account for?</label>
                <div class="account-type-options">
                  <label class="account-type-option" id="option-adult">
                    <input type="checkbox" name="accountType" value="adult" class="account-type-checkbox" checked tabindex="-1">
                    <div class="account-type-card selected">
                      <i class="fas fa-user-graduate"></i>
                      <span class="account-type-title">Myself</span>
                      <span class="account-type-desc">I'm an adult learner (18+)</span>
                    </div>
                  </label>
                  <label class="account-type-option" id="option-child">
                    <input type="checkbox" name="accountType" value="child" class="account-type-checkbox" tabindex="-1">
                    <div class="account-type-card">
                      <i class="fas fa-child"></i>
                      <span class="account-type-title">My Child</span>
                      <span class="account-type-desc">Registering a K-12 student</span>
                    </div>
                  </label>
                </div>
              </div>

              <button type="button" class="auth-modal-button primary" id="signup-next-step">
                Continue <i class="fas fa-arrow-right"></i>
              </button>
            </div>

            <!-- Step 2: Adult Registration (default) -->
            <div id="signup-step-adult" class="signup-step">
              <button type="button" class="back-to-step1" aria-label="Go back">
                <i class="fas fa-arrow-left"></i> Back
              </button>

              <div class="form-row">
                <div class="form-group">
                  <label for="signup-firstname">First Name</label>
                  <input
                    type="text"
                    id="signup-firstname"
                    name="firstname"
                    placeholder="Enter your first name"
                    autocomplete="given-name"
                    aria-required="true">
                </div>

                <div class="form-group">
                  <label for="signup-lastname">Last Name</label>
                  <input
                    type="text"
                    id="signup-lastname"
                    name="lastname"
                    placeholder="Enter your last name"
                    autocomplete="family-name"
                    aria-required="true">
                </div>
              </div>

              <div class="form-group">
                <label for="signup-email">Email Address</label>
                <input
                  type="email"
                  id="signup-email"
                  name="email"
                  placeholder="you@example.com"
                  autocomplete="email"
                  aria-required="true">
              </div>

              <div class="form-group">
                <label for="signup-password">Password</label>
                <div class="password-wrapper">
                  <input
                    type="password"
                    id="signup-password"
                    name="password"
                    placeholder="Create a secure password"
                    autocomplete="new-password"
                    minlength="8"
                    aria-required="true"
                    aria-describedby="password-hint">
                  <button type="button" class="password-toggle" data-target="signup-password" aria-label="Toggle password visibility">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
                <small id="password-hint" class="form-hint">8+ chars, uppercase, lowercase, number, special char</small>
              </div>

              <button type="submit" class="auth-modal-button primary">
                Create Account
              </button>
            </div>

            <!-- Step 2: K-12 Child Registration -->
            <div id="signup-step-child" class="signup-step">
              <button type="button" class="back-to-step1" aria-label="Go back">
                <i class="fas fa-arrow-left"></i> Back
              </button>

              <div class="k12-info-banner">
                <i class="fas fa-shield-alt"></i>
                <span>We take child safety seriously. Parental consent is required for students under 13 (COPPA).</span>
              </div>

              <!-- Child's Information Section -->
              <div class="form-section">
                <h3 class="form-section-title">Child's Information</h3>

                <div class="form-row">
                  <div class="form-group">
                    <label for="child-firstname">Child's First Name</label>
                    <input
                      type="text"
                      id="child-firstname"
                      name="childFirstname"
                      placeholder="Enter first name"
                      aria-required="true">
                  </div>

                  <div class="form-group">
                    <label for="child-lastname">Child's Last Name</label>
                    <input
                      type="text"
                      id="child-lastname"
                      name="childLastname"
                      placeholder="Enter last name"
                      aria-required="true">
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="child-dob">Date of Birth</label>
                    <input
                      type="date"
                      id="child-dob"
                      name="childDob"
                      max=""
                      aria-required="true"
                      aria-describedby="dob-hint">
                    <small id="dob-hint" class="form-hint">Required for age-appropriate content</small>
                  </div>

                  <div class="form-group">
                    <label for="child-grade">Current Grade Level</label>
                    <select id="child-grade" name="childGrade" aria-required="true">
                      <option value="">Select grade...</option>
                      <optgroup label="Elementary (K-5)">
                        <option value="K">Kindergarten</option>
                        <option value="1">Grade 1</option>
                        <option value="2">Grade 2</option>
                        <option value="3">Grade 3</option>
                        <option value="4">Grade 4</option>
                        <option value="5">Grade 5</option>
                      </optgroup>
                      <optgroup label="Middle School (6-8)">
                        <option value="6">Grade 6</option>
                        <option value="7">Grade 7</option>
                        <option value="8">Grade 8</option>
                      </optgroup>
                      <optgroup label="High School (9-12)">
                        <option value="9">Grade 9</option>
                        <option value="10">Grade 10</option>
                        <option value="11">Grade 11</option>
                        <option value="12">Grade 12</option>
                      </optgroup>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Parent/Guardian Information Section -->
              <div class="form-section">
                <h3 class="form-section-title">Parent/Guardian Information</h3>

                <div class="form-row">
                  <div class="form-group">
                    <label for="parent-firstname">Your First Name</label>
                    <input
                      type="text"
                      id="parent-firstname"
                      name="parentFirstname"
                      placeholder="Enter your first name"
                      autocomplete="given-name"
                      aria-required="true">
                  </div>

                  <div class="form-group">
                    <label for="parent-lastname">Your Last Name</label>
                    <input
                      type="text"
                      id="parent-lastname"
                      name="parentLastname"
                      placeholder="Enter your last name"
                      autocomplete="family-name"
                      aria-required="true">
                  </div>
                </div>

                <div class="form-group">
                  <label for="parent-email">Your Email Address</label>
                  <input
                    type="email"
                    id="parent-email"
                    name="parentEmail"
                    placeholder="parent@example.com"
                    autocomplete="email"
                    aria-required="true"
                    aria-describedby="parent-email-hint">
                  <small id="parent-email-hint" class="form-hint">Consent & verification emails will be sent here</small>
                </div>

                <div class="form-group">
                  <label for="parent-password">Create Password</label>
                  <div class="password-wrapper">
                    <input
                      type="password"
                      id="parent-password"
                      name="parentPassword"
                      placeholder="Create a secure password"
                      autocomplete="new-password"
                      minlength="8"
                      aria-required="true"
                      aria-describedby="parent-password-hint">
                    <button type="button" class="password-toggle" data-target="parent-password" aria-label="Toggle password visibility">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                  <small id="parent-password-hint" class="form-hint">8+ chars, uppercase, lowercase, number, special char</small>
                </div>
              </div>

              <!-- Consent Checkbox -->
              <div class="form-group consent-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="parent-consent" name="parentConsent" required>
                  <span>I am the parent/legal guardian and consent to create this account for my child. I understand I will receive a verification email to complete the registration.</span>
                </label>
              </div>

              <button type="submit" class="auth-modal-button primary" id="signup-child-submit">
                <i class="fas fa-user-plus"></i> Register My Child
              </button>
            </div>
          </form>
          
          <p class="auth-modal-footer-text">
            Already have an account? 
            <button type="button" class="auth-modal-link" data-switch-to="signin">Sign in here</button>
          </p>
        </div>
        
        <!-- Sign In Panel -->
        <div 
          id="signin-panel" 
          class="auth-modal-panel" 
          role="tabpanel" 
          aria-labelledby="signin-tab"
          aria-hidden="true">
          
          <h2 class="auth-modal-title">Welcome Back</h2>
          <p class="auth-modal-subtitle">Sign in to continue your learning</p>
          
          <!-- Error/Success Messages -->
          <div id="signin-message" class="auth-modal-message" role="alert" aria-live="polite"></div>
          
          <form id="signin-form" class="auth-modal-form">
            <div class="form-group">
              <label for="signin-email">Email Address</label>
              <input 
                type="email" 
                id="signin-email" 
                name="email" 
                autocomplete="email"
                required
                aria-required="true">
            </div>
            
            <div class="form-group">
              <label for="signin-password">Password</label>
              <div class="password-wrapper">
                <input 
                  type="password" 
                  id="signin-password" 
                  name="password"
                  autocomplete="current-password"
                  minlength="6"
                  required
                  aria-required="true">
                <button type="button" class="password-toggle" data-target="signin-password" aria-label="Toggle password visibility">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            
            <div class="form-group-inline">
              <a href="#" class="auth-modal-link-small">Forgot password?</a>
            </div>
            
            <button type="submit" class="auth-modal-button primary">
              Sign In
            </button>
          </form>
          
          <p class="auth-modal-footer-text">
            Don't have an account? 
            <button type="button" class="auth-modal-link" data-switch-to="signup">Sign up here</button>
          </p>
        </div>
      </div>
      
      <!-- Cookie Warning (shown if localStorage is blocked) -->
      <div id="cookie-warning" class="auth-modal-warning hidden" role="alert">
        <i class="fas fa-exclamation-triangle"></i>
        <span>Cookies/Storage appear to be blocked. Please enable them to sign in.</span>
      </div>
    </div>
  </div>
</div>
