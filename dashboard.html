<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | PMERIT</title>
  <meta name="description" content="PMERIT Dashboard - Your personalized learning portal with courses, progress tracking, and career guidance"/>
    <!-- Theme Init - Prevent FOUC -->
  <script>
  (function() {
    var theme = localStorage.getItem('theme');
    if (!theme && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      theme = 'dark';
    }
    if (theme === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
    }
  })();
  </script>

<link rel="stylesheet" href="assets/css/theme-variables.css">
  <link rel="stylesheet" href="assets/css/base.css">
  <link rel="stylesheet" href="assets/css/brand.css">
  <link rel="stylesheet" href="assets/css/learner-portal-layout.css">
  <link rel="stylesheet" href="assets/css/components.css">
  <link rel="stylesheet" href="assets/css/responsive.css">
  <link rel="stylesheet" href="assets/css/responsive-fixes.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <style>
    /* Hybrid Layout Specific Styles */
    .portal-section { margin-bottom: 2.5rem; }
    .portal-section h2 { color: var(--color-primary); margin-bottom: 0.5rem; }
    .feature-list { list-style: disc; margin-left: 2rem; }
    .dashboard-cards { display: flex; flex-wrap: wrap; gap: 1.5rem; margin: 2rem 0; }
    .dashboard-card { flex: 1 1 260px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 1.5rem; box-shadow: var(--shadow-sm); min-width: 220px; transition: var(--transition-base); }
    .dashboard-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }
    .dashboard-card h3 { margin-top: 0; color: var(--color-primary); display: flex; align-items: center; gap: 0.5rem; }
    .dashboard-card ul { margin: 0.5rem 0 0 1.2rem; }
    .mermaid { background: var(--bg-secondary); border-radius: 8px; padding: 1rem; margin: 2rem 0; overflow-x: auto; }
    
    /* Classroom section styles */
    .classroom-section {
      display: none;
      margin-bottom: 2rem;
    }
    
    .classroom-section.active {
      display: block;
    }
    
    .classroom-iframe-container {
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border-color);
      box-shadow: var(--shadow-md);
      background: #0b0c10;
    }
    
    .classroom-iframe {
      width: 100%;
      height: 800px;
      border: none;
      display: block;
    }
    
    @media (max-width: 768px) {
      .dashboard-cards { flex-direction: column; }
      .classroom-iframe { height: 600px; }
    }

    /* Enrolled Courses Styles */
    .enrolled-courses-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
    }

    .enrolled-course-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 1.25rem;
      box-shadow: var(--shadow-sm);
      transition: var(--transition-base);
    }

    .enrolled-course-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .enrolled-course-card .course-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .enrolled-course-card h4 {
      margin: 0;
      color: var(--color-primary);
      font-size: 1.1rem;
      line-height: 1.3;
    }

    .course-status {
      font-size: 0.7rem;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-weight: 600;
      white-space: nowrap;
    }

    .status-pending { background: var(--bg-secondary); color: var(--text-secondary); }
    .status-active { background: #e3f2fd; color: #1976d2; }
    .status-complete { background: #e8f5e9; color: #388e3c; }
    .status-paused { background: #fff3e0; color: #f57c00; }

    .course-description {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .course-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.75rem;
    }

    .course-meta span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .course-progress {
      margin-bottom: 1rem;
    }

    .progress-bar {
      height: 8px;
      background: var(--bg-secondary);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 0.35rem;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--color-primary), var(--color-accent, #4caf50));
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    .progress-text {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .course-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      border: none;
      text-decoration: none;
      transition: var(--transition-base);
    }

    .btn-sm {
      padding: 0.35rem 0.75rem;
      font-size: 0.8rem;
    }

    .btn-primary {
      background: var(--color-primary);
      color: white;
    }

    .btn-primary:hover {
      opacity: 0.9;
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-primary);
    }

    .btn-outline:hover {
      background: var(--bg-secondary);
    }

    .btn-danger {
      background: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    /* Empty/Error States */
    .empty-state, .error-state, .loading {
      text-align: center;
      padding: 2rem;
      color: var(--text-secondary);
    }

    .empty-state h3 {
      margin: 0.5rem 0;
      color: var(--text-primary);
    }

    .loading {
      font-size: 1rem;
    }

    /* Recommendations */
    .recommendations-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .recommendation-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
    }

    .recommendation-card .rec-icon {
      font-size: 2rem;
      color: var(--color-primary);
      margin-bottom: 0.5rem;
    }

    .recommendation-card h4 {
      margin: 0.5rem 0;
      font-size: 1rem;
    }

    .recommendation-card p {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .match-reason {
      display: block;
      font-size: 0.75rem;
      color: var(--color-primary);
      margin-bottom: 0.75rem;
    }

    .take-assessment-prompt {
      background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
      border: 2px dashed var(--border-color);
      border-radius: 12px;
      padding: 2rem;
      text-align: center;
    }

    .take-assessment-prompt h4 {
      margin: 0.75rem 0 0.5rem;
    }

    .take-assessment-prompt p {
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-top: -0.5rem;
    }

    /* Pathway Progress */
    .pathway-progress-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .pathway-progress-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 1rem;
    }

    .pathway-progress-card .pathway-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .pathway-progress-card h4 {
      margin: 0;
      font-size: 1rem;
    }

    .track-badge {
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      background: var(--bg-secondary);
      border-radius: 4px;
      color: var(--text-muted);
    }

    .pathway-stats {
      display: flex;
      gap: 1rem;
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
    }

    .pathway-stats span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    /* Quick Actions */
    .quick-actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 1rem;
    }

    .quick-action-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 1.25rem 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      text-decoration: none;
      color: var(--text-primary);
      transition: var(--transition-base);
    }

    .quick-action-card:hover {
      background: var(--bg-secondary);
      border-color: var(--color-primary);
      transform: translateY(-2px);
    }

    .quick-action-card i {
      font-size: 1.5rem;
      color: var(--color-primary);
    }

    .quick-action-card span {
      font-size: 0.85rem;
      font-weight: 500;
      text-align: center;
    }
  </style>
  <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
  
  <!-- Load config and auth modules first -->
  <script src="assets/js/config.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/auth-check.js"></script>
  <script src="assets/js/dashboard-courses.js"></script>
</head>
<body>
  <!-- Overlay for mobile panel toggling -->
  <div class="panel-overlay" id="panel-overlay" tabindex="-1" aria-hidden="true"></div>

  <!-- Icon Sidebar (Left) -->
  <aside class="icon-sidebar" role="navigation" aria-label="Main navigation">
    <nav class="icon-sidebar-nav">
      <button class="icon-sidebar-item active" data-section="dashboard" aria-label="Dashboard" aria-pressed="true">
        <i class="fas fa-home"></i>
      </button>
      <button class="icon-sidebar-item" data-section="courses" aria-label="Courses" aria-pressed="false">
        <i class="fas fa-book"></i>
      </button>
      <button class="icon-sidebar-item" data-section="progress" aria-label="Progress" aria-pressed="false">
        <i class="fas fa-chart-line"></i>
      </button>
      <button class="icon-sidebar-item" data-section="career" aria-label="Career" aria-pressed="false">
        <i class="fas fa-briefcase"></i>
      </button>
      <button class="icon-sidebar-item" data-section="certificates" aria-label="Certificates" aria-pressed="false">
        <i class="fas fa-certificate"></i>
      </button>
      <button class="icon-sidebar-item" data-section="community" aria-label="Community" aria-pressed="false">
        <i class="fas fa-users"></i>
      </button>
      <button class="icon-sidebar-item" data-section="library" aria-label="Library" aria-pressed="false">
        <i class="fas fa-book-reader"></i>
      </button>
      <button class="icon-sidebar-item" data-section="support" aria-label="Support" aria-pressed="false">
        <i class="fas fa-life-ring"></i>
      </button>
    </nav>
    <div class="icon-sidebar-footer">
      <!-- Admin Portal Link - Hidden by default, shown only for admin users -->
      <a href="/admin/" class="icon-sidebar-item" id="admin-portal-link" aria-label="Admin Portal" style="display: none; text-decoration: none;">
        <i class="fas fa-shield-alt"></i>
      </a>
      <button class="icon-sidebar-item" data-section="settings" aria-label="Settings" aria-pressed="false">
        <i class="fas fa-cog"></i>
      </button>
    </div>
  </aside>

  <!-- Navigation Panel -->
  <aside class="nav-panel" id="nav-panel" role="complementary" aria-label="Section navigation">
    <!-- User Profile Mini-Section -->
    <div class="nav-panel-header">
      <div class="user-profile-mini">
        <div class="user-avatar" aria-hidden="true">
          <span id="user-avatar-initial">U</span>
        </div>
        <div class="user-details">
          <span class="user-name" id="user-name">Learner</span>
          <span class="user-role">Student</span>
        </div>
      </div>
    </div>

    <!-- Navigation Content (Context-specific menus) -->
    <div class="nav-panel-content">
      <!-- Dashboard Section -->
      <div class="nav-section active" id="nav-dashboard">
        <h2 class="nav-section-title">Dashboard</h2>
        <ul class="nav-menu">
          <li class="nav-menu-item">
            <a href="#overview" class="nav-menu-link">
              <i class="fas fa-chart-pie"></i>
              <span>Overview</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#activity" class="nav-menu-link">
              <i class="fas fa-clock"></i>
              <span>Recent Activity</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#my-courses-section" class="nav-menu-link" onclick="document.getElementById('my-courses-section').scrollIntoView({behavior:'smooth'}); return false;">
              <i class="fas fa-chalkboard-teacher"></i>
              <span>Enter Classroom</span>
            </a>
          </li>
        </ul>
      </div>

      <!-- Courses Section -->
      <div class="nav-section" id="nav-courses">
        <h2 class="nav-section-title">Courses</h2>
        <ul class="nav-menu">
          <li class="nav-menu-item">
            <a href="courses.html" class="nav-menu-link">
              <i class="fas fa-th-list"></i>
              <span>All Courses</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#enrolled" class="nav-menu-link">
              <i class="fas fa-user-check"></i>
              <span>My Courses</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#paths" class="nav-menu-link">
              <i class="fas fa-route"></i>
              <span>Learning Paths</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#recommendations" class="nav-menu-link">
              <i class="fas fa-star"></i>
              <span>Recommended</span>
            </a>
          </li>
        </ul>
      </div>

      <!-- Progress Section -->
      <div class="nav-section" id="nav-progress">
        <h2 class="nav-section-title">Progress</h2>
        <ul class="nav-menu">
          <li class="nav-menu-item">
            <a href="progress.html" class="nav-menu-link">
              <i class="fas fa-tachometer-alt"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="assessment-entry.html" class="nav-menu-link">
              <i class="fas fa-clipboard-check"></i>
              <span>Assessments</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#badges" class="nav-menu-link">
              <i class="fas fa-trophy"></i>
              <span>Badges & Awards</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#milestones" class="nav-menu-link">
              <i class="fas fa-flag-checkered"></i>
              <span>Milestones</span>
            </a>
          </li>
        </ul>
      </div>

      <!-- Career Section -->
      <div class="nav-section" id="nav-career">
        <h2 class="nav-section-title">Career</h2>
        <ul class="nav-menu">
          <li class="nav-menu-item">
            <a href="pathways.html" class="nav-menu-link">
              <i class="fas fa-compass"></i>
              <span>Learning Pathways</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="assessment-entry.html" class="nav-menu-link">
              <i class="fas fa-clipboard-list"></i>
              <span>Career Assessment</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#jobs" class="nav-menu-link">
              <i class="fas fa-search"></i>
              <span>Job Explorer</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#skills" class="nav-menu-link">
              <i class="fas fa-lightbulb"></i>
              <span>Skills Matrix</span>
            </a>
          </li>
        </ul>
      </div>

      <!-- Certificates Section -->
      <div class="nav-section" id="nav-certificates">
        <h2 class="nav-section-title">Certificates</h2>
        <ul class="nav-menu">
          <li class="nav-menu-item">
            <a href="#mycerts" class="nav-menu-link">
              <i class="fas fa-award"></i>
              <span>My Certificates</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#verify" class="nav-menu-link">
              <i class="fas fa-check-circle"></i>
              <span>Verify Certificate</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#download" class="nav-menu-link">
              <i class="fas fa-download"></i>
              <span>Download</span>
            </a>
          </li>
        </ul>
      </div>

      <!-- Community Section -->
      <div class="nav-section" id="nav-community">
        <h2 class="nav-section-title">Community</h2>
        <ul class="nav-menu">
          <li class="nav-menu-item">
            <a href="community.html" class="nav-menu-link">
              <i class="fas fa-comments"></i>
              <span>Forum</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#groups" class="nav-menu-link">
              <i class="fas fa-user-friends"></i>
              <span>Study Groups</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#events" class="nav-menu-link">
              <i class="fas fa-calendar-alt"></i>
              <span>Events</span>
            </a>
          </li>
        </ul>
      </div>

      <!-- Library Section -->
      <div class="nav-section" id="nav-library">
        <h2 class="nav-section-title">Library</h2>
        <ul class="nav-menu">
          <li class="nav-menu-item">
            <a href="#resources" class="nav-menu-link">
              <i class="fas fa-book-open"></i>
              <span>Resources</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#saved" class="nav-menu-link">
              <i class="fas fa-bookmark"></i>
              <span>Saved Items</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#downloads" class="nav-menu-link">
              <i class="fas fa-download"></i>
              <span>Offline Content</span>
            </a>
          </li>
        </ul>
      </div>

      <!-- Support Section -->
      <div class="nav-section" id="nav-support">
        <h2 class="nav-section-title">Support</h2>
        <ul class="nav-menu">
          <li class="nav-menu-item">
            <a href="support.html" class="nav-menu-link">
              <i class="fas fa-question-circle"></i>
              <span>Help Center</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#ai-chat" class="nav-menu-link">
              <i class="fas fa-robot"></i>
              <span>AI Assistant</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="contact.html" class="nav-menu-link">
              <i class="fas fa-envelope"></i>
              <span>Contact Support</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#tickets" class="nav-menu-link">
              <i class="fas fa-ticket-alt"></i>
              <span>My Tickets</span>
            </a>
          </li>
        </ul>
      </div>

      <!-- Settings Section -->
      <div class="nav-section" id="nav-settings">
        <h2 class="nav-section-title">Settings</h2>
        <ul class="nav-menu">
          <li class="nav-menu-item">
            <a href="profile.html" class="nav-menu-link">
              <i class="fas fa-user-edit"></i>
              <span>Edit Profile</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="settings.html" class="nav-menu-link">
              <i class="fas fa-cog"></i>
              <span>Preferences</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#notifications" class="nav-menu-link">
              <i class="fas fa-bell"></i>
              <span>Notifications</span>
            </a>
          </li>
          <li class="nav-menu-item">
            <a href="#privacy" class="nav-menu-link">
              <i class="fas fa-shield-alt"></i>
              <span>Privacy</span>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Logout Button -->
    <div class="nav-panel-footer">
      <button class="logout-btn" id="logout-btn">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content Area -->
  <main class="main-content" id="main-content" role="main">
    <h1>Dashboard</h1>
    <section class="portal-section">
      <h2>Welcome, <span id="user-name-display">Learner</span>!</h2>
      <p>This is your personalized hub for managing your academic journey, career goals, and community engagement on PMERIT.</p>
      <p style="margin-top: 0.5rem;"><a href="/account.html" style="color: var(--color-primary); text-decoration: none;"><i class="fas fa-user-cog"></i> Manage Account Settings</a></p>
    </section>
    <section class="portal-section">
      <h2>Dashboard Overview</h2>
      <div class="dashboard-cards">
        <div class="dashboard-card">
          <h3><i class="fas fa-brain"></i> AI Assistant</h3>
          <ul>
            <li>Chat with PMERIT AI for help and recommendations</li>
            <li>Get support or escalate to a human</li>
          </ul>
        </div>
        <div class="dashboard-card">
          <h3><i class="fas fa-book"></i> My Courses & Paths</h3>
          <ul>
            <li>View enrolled courses and recommended paths</li>
            <li>Access interactive modules, quizzes, and offline content</li>
            <li><a href="#my-courses-section" class="text-accent" onclick="document.getElementById('my-courses-section').scrollIntoView({behavior:'smooth'}); return false;"><i class="fas fa-graduation-cap"></i> Enter Classroom (with Virtual Human)</a></li>
          </ul>
        </div>
        <div class="dashboard-card">
          <h3><i class="fas fa-chart-line"></i> Progress & Assessments</h3>
          <ul>
            <li>Track progress, milestones, and assessment scores</li>
            <li>Earn badges and certificates</li>
          </ul>
        </div>
        <div class="dashboard-card">
          <h3><i class="fas fa-briefcase"></i> Career Guidance</h3>
          <ul>
            <li>Take career assessments</li>
            <li>Explore job curricula and connect with employers</li>
          </ul>
        </div>
        <div class="dashboard-card">
          <h3><i class="fas fa-users"></i> Community & Support</h3>
          <ul>
            <li>Join forums, study groups, and get help</li>
            <li>Contact human support if needed</li>
          </ul>
        </div>
        <div class="dashboard-card">
          <h3><i class="fas fa-cog"></i> Settings & Profile</h3>
          <ul>
            <li>Manage your info, notifications, and privacy</li>
            <li>Parental/teacher oversight for minors</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- MY COURSES SECTION (P4.1, P4.3) -->
    <section class="portal-section" id="my-courses-section">
      <h2><i class="fas fa-book-open"></i> My Courses</h2>
      <div id="enrolled-courses-container">
        <div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading your courses...</div>
      </div>
    </section>

    <!-- PATHWAY PROGRESS SECTION (P4.5) -->
    <section class="portal-section" id="pathway-progress-section">
      <div id="pathway-progress-container">
        <!-- Pathway progress will be loaded dynamically -->
      </div>
    </section>

    <!-- RECOMMENDATIONS SECTION (P4.4, P4.7) -->
    <section class="portal-section" id="recommendations-section">
      <div id="recommendations-container">
        <!-- Recommendations will be loaded dynamically -->
      </div>
    </section>

    <!-- QUICK ACTIONS SECTION (P4.8) -->
    <section class="portal-section" id="quick-actions-section">
      <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
      <div class="quick-actions-grid">
        <a href="/courses.html" class="quick-action-card">
          <i class="fas fa-search"></i>
          <span>Browse Courses</span>
        </a>
        <a href="/assessment-entry.html" class="quick-action-card">
          <i class="fas fa-clipboard-check"></i>
          <span>Take Assessment</span>
        </a>
        <a href="/pathways.html" class="quick-action-card">
          <i class="fas fa-route"></i>
          <span>Explore Pathways</span>
        </a>
        <a href="#my-courses-section" class="quick-action-card" onclick="document.getElementById('my-courses-section').scrollIntoView({behavior:'smooth'}); return false;">
          <i class="fas fa-chalkboard-teacher"></i>
          <span>Enter Classroom</span>
        </a>
        <a href="/progress.html" class="quick-action-card">
          <i class="fas fa-chart-line"></i>
          <span>View Progress</span>
        </a>
        <a href="/support.html" class="quick-action-card">
          <i class="fas fa-question-circle"></i>
          <span>Get Help</span>
        </a>
      </div>
    </section>

    <section class="portal-section">
      <h2>Academic Information</h2>
      <ul class="feature-list">
        <li>Enrolled courses and learning paths</li>
        <li>Assessment and quiz results</li>
        <li>Progress tracking and milestones</li>
        <li>Certification status and downloadable certificates</li>
        <li>Career assessment results and recommendations</li>
        <li>Community participation and support tickets</li>
        <li>Profile and settings (including parent/teacher oversight for minors)</li>
      </ul>
    </section>
    <section class="portal-section">
      <h2>Security & Integrity</h2>
      <ul class="feature-list">
        <li>Multi-factor authentication (MFA) for login and sensitive actions</li>
        <li>AI-powered and human support for issue escalation</li>
        <li>Blockchain-backed certificate verification for authenticity</li>
        <li>Plagiarism and cheating prevention for assignments and exams</li>
        <li>Audit logs for all user activities</li>
      </ul>
    </section>
    <section class="portal-section">
      <h2>Accessibility & Global Reach</h2>
      <ul class="feature-list">
        <li>Designed for users in the USA, Nigeria, and globally</li>
        <li>Offline reading and low-bandwidth support</li>
        <li>Parental/teacher controls for minors (COPPA compliant)</li>
      </ul>
    </section>
    <section class="portal-section">
      <h2>Learner Journey Map</h2>
      <div class="mermaid">
        graph TD
            A[Learner Login] --> B[Learner Portal Dashboard];
            B --> C[AI Assistant: PMERIT AI];
            B --> D[My Courses & Learning Paths];
            B --> E[Assessments & Progress];
            B --> F[Career Guidance];
            B --> G[Community & Support];
            B --> H[Settings & Profile];

            C --> C1[Interact with AI Chat];
            C --> C2[Get Personalized Recommendations];
            C --> C3[Ask about platform services];
            C1 --> C4{AI can't resolve issue?};
            C4 -- Yes --> C5[Escalate to Human Support];

            D --> D1[View Enrolled Courses];
            D --> D2[Browse Course Catalog];
            D --> D3[View Recommended Paths];
            D1 --> D4[Access Course Content];
            D4 --> D4a[Interactive Modules];
            D4 --> D4b[Multimedia Content];
            D4 --> D4c[Quizzes & Exercises];
            D4 --> D4d[Discussions & Comments];
            D4 --> D4e[Offline Reading];

            E --> E1[Track Progress & Milestones];
            E --> E2[View Assessment Scores];
            E --> E3[See Certification Status];
            E1 --> E4[Gamification: Badges, Points, etc.];

            F --> F1[Take Career Assessment];
            F --> F2[Explore Remote Job Curricula];
            F --> F3[Link to Employer Networks];
            F1 --> F4[AI-powered career recommendations];
            F4 --> F5[Explore Job Skills & Requirements];

            G --> G1[Forum & Discussion Boards];
            G --> G2[Group Collaboration];
            G --> G3[AI-powered Study Groups];
            G --> G4[Contact Human Support];

            H --> H1[Edit Profile Information];
            H --> H2[Manage Notifications];
            H --> H3[Privacy Settings];
            H --> H4[Connect Social Accounts];
            H1 --> H5{Parent/Teacher-Managed?};
            H5 -- Yes --> H6[Oversight & Monitoring];

            subgraph "Learner Types"
                direction LR
                Adult(Adult Learner) --> B;
                Teen(Teen Learner) --> B;
                Child(Child Learner) --> B;
            end
            style Adult fill:#b3e5fc,stroke:#01579b,stroke-width:2px
            style Teen fill:#ffecb3,stroke:#ff8f00,stroke-width:2px
            style Child fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
      </div>
    </section>
    
    <!-- Classroom Section -->
    <section id="classroom-content" class="classroom-section" role="tabpanel" aria-labelledby="classroom-tab">
      <div class="portal-section">
        <h2><i class="fas fa-chalkboard-teacher"></i> PMERIT Classroom</h2>
        <p>Interactive learning environment with AI Tutor and Virtual Human support.</p>
        <p>
          <small>
            <a id="classroom-open-link" href="#my-courses-section" class="text-accent" onclick="document.getElementById('my-courses-section').scrollIntoView({behavior:'smooth'}); return false;">
              <i class="fas fa-external-link-alt"></i> Select a course to open classroom
            </a>
          </small>
        </p>
      </div>
      <div class="classroom-iframe-container" id="classroom-iframe-container" style="display: none;">
        <iframe
          id="classroom-iframe"
          class="classroom-iframe"
          src="about:blank"
          title="PMERIT Classroom"
          allow="microphone; camera; fullscreen"
          loading="lazy">
        </iframe>
      </div>
      <div id="classroom-placeholder" class="empty-state">
        <i class="fas fa-chalkboard-teacher" style="font-size: 3rem; color: var(--color-primary); margin-bottom: 1rem;"></i>
        <h3>Select a Course</h3>
        <p>Choose a course from "My Courses" above to enter the classroom.</p>
        <a href="#my-courses-section" class="btn btn-primary" onclick="document.getElementById('my-courses-section').scrollIntoView({behavior:'smooth'}); return false;">
          <i class="fas fa-book"></i> Go to My Courses
        </a>
      </div>
    </section>
  </main>

  <!-- Right Sidebar -->
  <aside class="right-sidebar" id="right-sidebar" role="complementary" aria-label="Quick actions and tasks">
    <!-- Quick Actions Section -->
    <div class="right-sidebar-section">
      <h2 class="right-sidebar-title">Quick Actions</h2>
      <div class="placeholder-content">
        <p><i class="fas fa-rocket"></i></p>
        <p>Quick action widgets will be added here</p>
        <small>(Issue 3)</small>
      </div>
    </div>

    <!-- To-Do List Section -->
    <div class="right-sidebar-section">
      <h2 class="right-sidebar-title">To-Do List</h2>
      <div class="placeholder-content">
        <p><i class="fas fa-tasks"></i></p>
        <p>Task list will be added here</p>
        <small>(Issue 3)</small>
      </div>
    </div>
  </aside>

  <script>
    (function () {
      'use strict';

      // Set user name and avatar from authenticated user
      const user = window.AUTH.getCurrentUser();
      if (user) {
        // Check multiple possible field name formats
        const firstName = user.first_name || user.firstName || '';
        const lastName = user.last_name || user.lastName || '';
        const fullName = `${firstName} ${lastName}`.trim();
        const displayName = fullName || user.email?.split('@')[0] || 'Learner';
        const initial = displayName.charAt(0).toUpperCase();

        document.getElementById('user-name-display').textContent = displayName;
        document.getElementById('user-name').textContent = displayName;
        document.getElementById('user-avatar-initial').textContent = initial;

        // Check if user is an admin (tier1_admin or tier2_admin)
        // Show admin portal link if they have admin role
        const userRole = user.role;
        if (userRole === 'tier1_admin' || userRole === 'tier2_admin') {
          const adminLink = document.getElementById('admin-portal-link');
          if (adminLink) {
            adminLink.style.display = 'flex';
          }
        }
      }

      // Handle logout button
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function () {
          if (confirm('Are you sure you want to log out?')) {
            window.AUTH.logout();
          }
        });
      }

      // Icon Sidebar Navigation
      const iconItems = document.querySelectorAll('.icon-sidebar-item');
      const navSections = document.querySelectorAll('.nav-section');
      const panelOverlay = document.getElementById('panel-overlay');
      const navPanel = document.getElementById('nav-panel');
      const rightSidebar = document.getElementById('right-sidebar');

      // Screen reader announcements
      const announcer = document.createElement('div');
      announcer.setAttribute('role', 'status');
      announcer.setAttribute('aria-live', 'polite');
      announcer.className = 'visually-hidden';
      document.body.appendChild(announcer);

      function announce(message) {
        announcer.textContent = message;
        setTimeout(() => {
          announcer.textContent = '';
        }, 1000);
      }

      function switchNavSection(sectionName) {
        // Remove active class from all icon items
        iconItems.forEach(item => {
          item.classList.remove('active');
          item.setAttribute('aria-pressed', 'false');
        });

        // Add active class to clicked item
        const activeItem = document.querySelector(`.icon-sidebar-item[data-section="${sectionName}"]`);
        if (activeItem) {
          activeItem.classList.add('active');
          activeItem.setAttribute('aria-pressed', 'true');
        }

        // Hide all nav sections
        navSections.forEach(section => {
          section.classList.remove('active');
        });

        // Show selected nav section
        const activeSection = document.getElementById(`nav-${sectionName}`);
        if (activeSection) {
          activeSection.classList.add('active');
          const title = activeSection.querySelector('.nav-section-title').textContent;
          announce(`Navigated to ${title}`);
        }
      }

      // Handle icon sidebar clicks
      iconItems.forEach(item => {
        item.addEventListener('click', function () {
          const section = this.dataset.section;
          switchNavSection(section);
        });

        // Keyboard support
        item.addEventListener('keydown', function (e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.click();
          }
        });
      });

      // Handle links within dashboard that point to #classroom - redirect to My Courses
      document.addEventListener('click', function (e) {
        const link = e.target.closest('a[href="#classroom"]');
        if (link) {
          e.preventDefault();
          // Scroll to My Courses section so user can pick a course
          const myCoursesSection = document.getElementById('my-courses-section');
          if (myCoursesSection) {
            myCoursesSection.scrollIntoView({ behavior: 'smooth' });
          }
        }
      });

      // Function to load classroom with a specific course (called from enrolled course cards)
      window.loadClassroomWithCourse = function(courseId) {
        const classroomSection = document.getElementById('classroom-content');
        const iframe = document.getElementById('classroom-iframe');
        const iframeContainer = document.getElementById('classroom-iframe-container');
        const placeholder = document.getElementById('classroom-placeholder');
        const openLink = document.getElementById('classroom-open-link');

        if (classroomSection && iframe && courseId) {
          // Update iframe src with courseId
          iframe.src = `/portal/classroom.html?courseId=${courseId}`;

          // Show iframe, hide placeholder
          iframeContainer.style.display = 'block';
          placeholder.style.display = 'none';

          // Update the open in new window link
          openLink.href = `/portal/classroom.html?courseId=${courseId}`;
          openLink.onclick = null;
          openLink.innerHTML = '<i class="fas fa-external-link-alt"></i> Open in new window';
          openLink.target = '_blank';

          // Show and scroll to classroom section
          classroomSection.classList.add('active');
          classroomSection.scrollIntoView({ behavior: 'smooth' });
        }
      };

      // Mobile panel toggles
      function toggleNavPanel() {
        const isOpen = navPanel.classList.toggle('open');
        panelOverlay.classList.toggle('active', isOpen);
        navPanel.setAttribute('aria-hidden', !isOpen);
      }

      function toggleRightSidebar() {
        const isOpen = rightSidebar.classList.toggle('open');
        panelOverlay.classList.toggle('active', isOpen);
        rightSidebar.setAttribute('aria-hidden', !isOpen);
      }

      // Close panels when clicking overlay
      panelOverlay.addEventListener('click', function () {
        navPanel.classList.remove('open');
        rightSidebar.classList.remove('open');
        panelOverlay.classList.remove('active');
        navPanel.setAttribute('aria-hidden', 'true');
        rightSidebar.setAttribute('aria-hidden', 'true');
      });

      // Initialize Mermaid for diagrams
      if (typeof mermaid !== 'undefined') {
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
      }

      // Close mobile panels on escape key
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
          navPanel.classList.remove('open');
          rightSidebar.classList.remove('open');
          panelOverlay.classList.remove('active');
          navPanel.setAttribute('aria-hidden', 'true');
          rightSidebar.setAttribute('aria-hidden', 'true');
        }
      });

      // Initialize: Set default section
      switchNavSection('dashboard');

      // Initialize Dashboard Courses Module (Phase 4)
      if (window.DashboardCourses) {
        // Load enrolled courses (P4.1)
        window.DashboardCourses.loadAndDisplayEnrollments();

        // Load pathway progress (P4.5)
        window.DashboardCourses.loadAndDisplayPathwayProgress();

        // Load recommendations based on assessment results (P4.4, P4.7)
        window.DashboardCourses.loadAndDisplayRecommendations();
      }
    })();
  </script>
</body>
</html>
